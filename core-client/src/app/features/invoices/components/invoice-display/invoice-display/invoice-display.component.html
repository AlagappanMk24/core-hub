<div class="relative min-h-screen bg-gray-50" @fadeIn>
  <!-- Actions Bar -->
  <div class="actions-container">
    <!-- <h2 class="text-2xl font-bold text-purple-700">{{ mode === 'preview' ? 'Invoice Preview' : '' }}</h2> -->
    <div class="flex space-x-4">
      <ng-container *ngIf="mode === 'view'">
        <button
          mat-raised-button
          color="primary"
          class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg transition-transform transform hover:scale-105"
          (click)="onSendInvoice()"
          [disabled]="isLoading"
          aria-label="Send invoice"
          @scaleIn
        >
          <mat-icon>send</mat-icon> Send Invoice
        </button>
        <button
          mat-raised-button
          color="accent"
          class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-transform transform hover:scale-105"
          (click)="onDownload()"
          [disabled]="isLoading"
          aria-label="Download PDF"
          @scaleIn
        >
          <mat-icon>download</mat-icon> Download PDF
        </button>
        <button
          mat-raised-button
          class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-transform transform hover:scale-105"
          (click)="onEditInvoice()"
          [disabled]="isLoading"
          aria-label="Edit invoice"
          @scaleIn
        >
          <mat-icon>edit</mat-icon> Edit Invoice
        </button>
        <button
          mat-stroked-button
          class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-2 rounded-lg transition-transform transform hover:scale-105"
          (click)="onBack()"
          [disabled]="isLoading"
          aria-label="Back to invoices"
          @scaleIn
        >
          <mat-icon>arrow_back</mat-icon> Back
        </button>
      </ng-container>
      <ng-container *ngIf="mode === 'preview'">
        <button
          mat-raised-button
          class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-2 rounded-lg transition-transform transform hover:scale-105"
          (click)="onClose()"
          aria-label="Close preview"
          @scaleIn
        >
          <mat-icon>close</mat-icon> Close
        </button>
      </ng-container>
    </div>
  </div>

  <!-- Invoice Content -->
  <div class="invoice-view-container mx-auto p-6 sm:p-8 bg-white rounded-2xl shadow-xl max-w-7xl">
    <!-- Header Section -->
    <div class="header p-8 rounded-t-2xl">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center">
        <div class="company-info">
          <h2 class="text-3xl font-semibold tracking-tight text-purple-700">{{ company?.name || 'KL Infotech' }}</h2>
          <p class="text-md italic mt-1">OUR FOCUS, YOUR FUTURE</p>
          <p class="text-md mt-2">{{ company?.address?.address1 || 'Besant Nagar, Chennai 45' }}</p>
          <p class="text-md mt-2">{{ company?.address?.city || '' }}, {{ company?.address?.state || '' }} {{ company?.address?.zipCode || '' }}</p>
          <p class="text-md mt-2" *ngIf="company?.address?.country">{{ company?.address?.country }}</p>
          <p class="text-md mt-2">{{ company?.email || 'support@klinfotech.com' }}</p>
        </div>
        <div class="invoice-info text-right mt-6 sm:mt-0">
          <h1 class="text-4xl font-semibold tracking-wide  text-purple-700">INVOICE</h1>
          <p class="text-md mt-2">Invoice No. #{{ invoice?.invoiceNumber || 'N/A' }}</p>
          <p class="text-md mt-2">Issue Date: {{ invoice?.issueDate | date:'dd MMM yyyy' }}</p>
          <p class="text-md mt-2">Due Date: {{ invoice?.dueDate | date:'dd MMM yyyy' }}</p>
        </div>
      </div>
    </div>
    <hr class="divider">
    <!-- Customer Info -->
    <div class="customer-info relative mt-8 p-6 rounded-lg">
      <h3 class="text-xl font-semibold text-purple-700">Bill To:</h3>
      <p class="text-lg mt-2 font-medium text-gray-800">{{ invoice?.customer?.name || 'Customer Name' }}</p>
      <p class="text-md mt-2 text-gray-600">{{ invoice?.customer?.address?.address1 || '' }} {{ invoice?.customer?.address?.address2 || '' }}</p>
      <p class="text-md mt-2 text-gray-600">{{ invoice?.customer?.address?.city || '' }}, {{ invoice?.customer?.address?.state || '' }} {{ invoice?.customer?.address?.zipCode || '' }}</p>
      <p class="text-md mt-2 text-gray-600" *ngIf="invoice?.customer?.address?.country">{{ invoice?.customer?.address?.country }}</p>
      <p class="text-md mt-2 text-gray-600">
        <span *ngIf="invoice?.customer?.email">Email: {{ invoice?.customer?.email }}</span>
        <span *ngIf="invoice?.customer?.phoneNumber" [ngClass]="{'ml-4': invoice?.customer?.email}">
          {{ invoice?.customer?.email ? '|' : '' }} Phone: {{ invoice?.customer?.phoneNumber }}
        </span>
      </p>
      <div class="total-box absolute top-10 right-10 bg-purple-500 text-white p-5 rounded-lg shadow-md">
        <p class="text-md">Total Amount</p>
        <p class="text-2xl mt-2 font-bold">{{ invoice?.totalAmount | currency:invoice?.currency || 'USD' }}</p>
      </div>
    </div>

    <!-- Items Table -->
    <div class="items-table mt-8">
      <table class="w-full border-collapse">
        <thead>
          <tr class="bg-purple-600 text-white">
            <th class="p-4 text-left text-sm font-semibold rounded-tl-lg">Item Description</th>
            <th class="p-4 text-center text-sm font-semibold">Qty</th>
            <th class="p-4 text-center text-sm font-semibold">Unit Price</th>
             <th class="p-4 text-center text-sm font-semibold">Tax Type</th>
            <th class="p-4 text-center text-sm font-semibold">Tax Amount</th>
            <th class="p-4 text-center text-sm font-semibold rounded-tr-lg">Total</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let item of invoice?.items; let i = index"
            class="border-b border-gray-200 hover:bg-gray-50 transition-colors"
            [ngClass]="{'bg-gray-50': i % 2 === 0}"
          >
            <td class="p-4 text-md text-gray-800">{{ item.description || 'N/A' }}</td>
            <td class="p-4 text-md text-center text-gray-800">{{ item.quantity }}</td>
            <td class="p-4 text-md text-center text-gray-800">{{ item.unitPrice | currency:invoice?.currency || 'USD' }}</td>
             <td class="p-4 text-md text-center text-gray-800">{{ item.taxType || 'N/A' }}</td>
            <td class="p-4 text-md text-center text-gray-800">{{ item.taxAmount | currency:invoice?.currency || 'USD' }}</td>
            <td class="p-4 text-md text-center text-gray-800">{{ item.amount | currency:invoice?.currency || 'USD' }}</td>
          </tr>
          <tr *ngIf="!invoice?.items?.length">
            <td colspan="6" class="p-4 text-center text-md text-gray-600">No items available.</td>
          </tr>
        </tbody>
      </table>
    </div>

       <!-- Payment Method -->
    <div class="payment-method mt-8 p-6" *ngIf="invoice?.paymentMethod">
      <h3 class="text-md font-semibold text-purple-700">Payment Method</h3>
      <p class="text-md text-gray-600">{{ invoice?.paymentMethod || 'Not specified' }}</p>
    </div>
    <!-- <div class="payment-method mt-8 p-6 bg-gray-100 rounded-lg" *ngIf="invoice?.paymentMethod">
      <h3 class="text-xl font-semibold text-purple-700">Payment Method</h3>
      <p class="text-md text-gray-600">{{ invoice?.paymentMethod }}</p>
    </div> -->


    <!-- Summary Section -->
    <!-- <div class="summary mt-8 flex justify-end">
      <div class="summary-box w-full sm:w-80 bg-gray-100 p-6 rounded-lg shadow-md" @scaleIn>
        <div class="summary-item flex justify-between text-md text-gray-800 mb-2">
          <span>Sub Total:</span>
          <span>{{ invoice?.subtotal | currency:invoice?.currency || 'USD' }}</span>
        </div>
        <ng-container *ngFor="let tax of invoice?.taxDetails">
          <div class="summary-item flex justify-between text-md text-gray-800 mb-2">
            <span>Tax ({{ tax.rate }}%):</span>
            <span>{{ tax.amount | currency:invoice?.currency || 'USD' }}</span>
          </div>
        </ng-container>
        <ng-container *ngFor="let discount of invoice?.discounts">
          <div class="summary-item flex justify-between text-md text-red-600 mb-2">
            <span>{{ discount.isPercentage ? 'Discount (' + discount.amount + '%)' : 'Discount' }}:</span>
            <span>-{{ discount.amount | currency:invoice?.currency || 'USD' }}</span>
          </div>
        </ng-container>
        <hr class="border-gray-300 my-4">
        <div class="summary-item flex justify-between text-lg font-bold text-purple-700">
          <span>Total:</span>
          <span>{{ invoice?.totalAmount | currency:invoice?.currency || 'USD' }}</span>
        </div>
      </div>
    </div> -->

    <!-- Summary Section -->
    <div class="summary">
      <div class="summary-box">
        <div class="summary-item">
          <span>Sub Total:</span>
          <span>{{ invoice?.subtotal | currency:invoice?.currency || 'USD' }}</span>
        </div>
        <ng-container *ngFor="let tax of invoice?.taxDetails">
          <div class="summary-item">
            <span>Tax ({{ tax.rate }}%):</span>
            <span>{{ tax.amount | currency:invoice?.currency || 'USD' }}</span>
          </div>
        </ng-container>
        <ng-container *ngFor="let discount of invoice?.discounts">
          <div class="summary-item discount">
            <span>{{ discount.isPercentage ? 'Discount (' + discount.amount + '%)' : 'Discount' }}:</span>
            <span>-{{ discount.amount | currency:invoice?.currency || 'USD' }}</span>
          </div>
        </ng-container>
        <hr class="summary-divider">
        <div class="summary-item total">
          <span>Total:</span>
          <span>{{ invoice?.totalAmount | currency:invoice?.currency || 'USD' }}</span>
        </div>
      </div>
    </div>


    <!-- Terms & Conditions -->
    <!-- <div class="terms mt-8 p-6 bg-gray-100 rounded-lg">
      <h3 class="text-xl font-semibold text-purple-700">Terms & Conditions</h3>
      <p class="text-sm text-gray-600">{{ invoice?.notes || 'Thank you for your business! Payment is due within 30 days of invoice date.' }}</p>
    </div>   -->
    <div class="terms mt-8 p-6">
      <h3 class="text-md font-semibold text-purple-700">Terms & Conditions</h3>
      <p class="text-md text-gray-600">{{ invoice?.notes || 'Thank you for your business! Payment is due within 30 days of invoice date.' }}</p>
    </div>


    <!-- Footer -->
    <div class="wave-footer mt-8">
      <svg viewBox="0 0 500 60" preserveAspectRatio="none" class="w-full h-12">
        <path d="M0,30 C150,60 350,0 500,30 L500,60 L0,60 Z" fill="#a78bfa"></path>
      </svg>
    </div>
  </div>

  <!-- Loading Spinner -->
  <ng-template #loadingSpinner>
    <div class="loading-container flex justify-center items-center h-screen bg-gray-50" @fadeIn>
      <mat-spinner diameter="50" color="accent"></mat-spinner>
    </div>
  </ng-template>
</div>